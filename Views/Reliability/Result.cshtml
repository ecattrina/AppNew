@model AppNew.Models.ReliabilityResultModel
@{
    ViewData["Title"] = "Результаты расчета";
}

<div class="container mt-4">
    <h2 class="mb-4">Результаты расчета показателей надежности</h2>

    <div class="card mb-4 border-info">
        <div class="card-header bg-info text-white">
            <h5 class="mb-0">Алгоритм расчета</h5>
        </div>
        <div class="card-body">
            <p>Для каждого момента времени t<sub>i</sub> рассчитываются следующие показатели:</p>
            <ol>
                <li><strong>Вероятность безотказной работы:</strong> P̂(t<sub>i</sub>) = (N - n(t<sub>i</sub>)) / N</li>
                <li><strong>Вероятность отказов:</strong> F̂(t<sub>i</sub>) = n(t<sub>i</sub>) / N</li>
                <li><strong>Плотность распределения отказов:</strong> f̂(t<sub>i</sub>) = Δn<sub>i</sub> / (N · Δt<sub>i</sub>), где Δn<sub>i</sub> = n(t<sub>i</sub>) - n(t<sub>i-1</sub>), Δt<sub>i</sub> = t<sub>i</sub> - t<sub>i-1</sub></li>
                <li><strong>Интенсивность отказов:</strong> λ̂(t<sub>i</sub>) = Δn<sub>i</sub> / ((N - n(t<sub>i-1</sub>)) · Δt<sub>i</sub>), где в знаменателе берется количество работающих объектов на начало интервала</li>
            </ol>
            <p class="mb-0"><small class="text-muted">Для первого интервала: t = 0 до t = t<sub>1</sub>, n(0) = 0</small></p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5>Исходные данные</h5>
        </div>
        <div class="card-body">
            <p><strong>Общее число объектов (N):</strong> @Model.TotalObjects</p>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5>Результаты расчетов</h5>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-striped table-bordered">
                    <thead class="table-dark">
                        <tr>
                            <th rowspan="2">t<sub>i</sub> (ч)</th>
                            <th rowspan="2">n(t<sub>i</sub>)</th>
                            <th rowspan="2">P̂(t<sub>i</sub>)<br/><small>Вероятность безотказной работы</small></th>
                            <th rowspan="2">F̂(t<sub>i</sub>)<br/><small>Вероятность отказов</small></th>
                            <th colspan="2">Промежуточные значения</th>
                            <th rowspan="2">f̂(t<sub>i</sub>) (1/ч)<br/><small>Плотность распределения отказов</small></th>
                            <th rowspan="2">λ̂(t<sub>i</sub>) (1/ч)<br/><small>Интенсивность отказов</small></th>
                        </tr>
                        <tr>
                            <th>Δn<sub>i</sub></th>
                            <th>Δt<sub>i</sub></th>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var calc in Model.Calculations)
                        {
                            <tr>
                                <td><strong>@calc.Time.ToString("F2")</strong></td>
                                <td><strong>@calc.Failures</strong></td>
                                <td class="result-table-highlight"><strong>@calc.ReliabilityProbability.ToString("F4")</strong></td>
                                <td class="result-table-highlight"><strong>@calc.FailureProbability.ToString("F4")</strong></td>
                                <td>@calc.DeltaN.ToString("F0")</td>
                                <td>@calc.DeltaT.ToString("F2")</td>
                                <td class="result-table-highlight"><strong>@calc.FailureDensity.ToString("F6")</strong></td>
                                <td class="result-table-highlight"><strong>@calc.FailureRate.ToString("F6")</strong></td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="card mb-4">
        <div class="card-header">
            <h5>Детальные расчеты</h5>
        </div>
        <div class="card-body">
            @for (int i = 0; i < Model.Calculations.Count; i++)
            {
                var calc = Model.Calculations[i];
                <div class="mb-4 p-3 bg-light rounded">
                    <h6 class="mb-3 fw-semibold">Для t<sub>@(i+1)</sub> = @calc.Time.ToString("F2") ч:</h6>
                    <ul class="list-unstyled ms-3 mb-0">
                        <li class="mb-2">n(t<sub>@(i+1)</sub>) = @calc.Failures</li>
                        <li class="mb-2">P̂(@calc.Time.ToString("F2")) = (@Model.TotalObjects - @calc.Failures) / @Model.TotalObjects = <span class="result-highlight">@calc.ReliabilityProbability.ToString("F4")</span></li>
                        <li class="mb-2">F̂(@calc.Time.ToString("F2")) = @calc.Failures / @Model.TotalObjects = <span class="result-highlight">@calc.FailureProbability.ToString("F4")</span></li>
                        @if (i == 0)
                        {
                            <li class="mb-2">Δn<sub>@(i+1)</sub> = @calc.Failures - 0 = @calc.DeltaN.ToString("F0")</li>
                            <li class="mb-2">Δt<sub>@(i+1)</sub> = @calc.Time.ToString("F2") - 0 = @calc.DeltaT.ToString("F2")</li>
                        }
                        else
                        {
                            var prevCalc = Model.Calculations[i - 1];
                            <li class="mb-2">Δn<sub>@(i+1)</sub> = @calc.Failures - @prevCalc.Failures = @calc.DeltaN.ToString("F0")</li>
                            <li class="mb-2">Δt<sub>@(i+1)</sub> = @calc.Time.ToString("F2") - @prevCalc.Time.ToString("F2") = @calc.DeltaT.ToString("F2")</li>
                        }
                        <li class="mb-2">f̂(@calc.Time.ToString("F2")) = @calc.DeltaN.ToString("F0") / (@Model.TotalObjects · @calc.DeltaT.ToString("F2")) = <span class="result-highlight">@calc.FailureDensity.ToString("F6")</span> (1/ч)</li>
                        @if (i == 0)
                        {
                            <li class="mb-2">λ̂(@calc.Time.ToString("F2")) = @calc.DeltaN.ToString("F0") / ((@Model.TotalObjects - 0) · @calc.DeltaT.ToString("F2")) = <span class="result-highlight">@calc.FailureRate.ToString("F6")</span> (1/ч)</li>
                        }
                        else
                        {
                            var prevCalc = Model.Calculations[i - 1];
                            <li class="mb-2">λ̂(@calc.Time.ToString("F2")) = @calc.DeltaN.ToString("F0") / ((@Model.TotalObjects - @prevCalc.Failures) · @calc.DeltaT.ToString("F2")) = <span class="result-highlight">@calc.FailureRate.ToString("F6")</span> (1/ч)</li>
                        }
                    </ul>
                </div>
            }
        </div>
    </div>

    <div class="mb-3 d-flex flex-column flex-md-row gap-2">
        <a asp-action="Index" class="btn btn-primary">Новый расчет</a>
        <a asp-controller="Home" asp-action="Index" class="btn btn-secondary">Выбор задачи</a>
    </div>
</div>

